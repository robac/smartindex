function getParameterByName(url, name)
{
  name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
  var regexS = "[\\?&]" + name + "=([^&#]*)";
  var regex = new RegExp(regexS);
  var results = regex.exec(url);
  if(results == null)
    return "";
  else
    return decodeURIComponent(results[1].replace(/\+/g, " "));
}

function getSmartIndexConf(tree) {
        return window[jQuery(tree).attr('id')+'_conf'];
}

function SmartIndexOpenFolder(event) {
        var link = jQuery(this).children("a");
        if (link.parent().siblings("ul").length == 0) {
            if (link.parent().parent().hasClass("waiting")) {
                return false;
            }
            link.parent().parent().addClass("waiting");
            jQuery.get(event.data.url, {namespace: getParameterByName(link.attr('href'), 'idx')}, function(data){
                link.parent().parent().append(data);
                link.parent().parent().removeClass("waiting");
            });
        }
        link.parent().parent().removeClass('closed').addClass('open');
        return false;
}

function SmartIndexCloseFolder(event) {
    jQuery(this).parent().removeClass('open').addClass('closed');
    return false;
}

function SmartIndexCloseFolder2(event) {
    alert('folder2'); return false;
}


function initSmartIndexTree(tree) {
    var conf = getSmartIndexConf(tree);
    var id = jQuery(tree).attr('id');
    jQuery.each(conf.openActions, function(key, value){
        jQuery(tree).delegate('#'+id+' '+value.selector, value.event, conf, window[value.func]);
    });
}

function initSmartIndex() {
    jQuery.each(jQuery('div.smartindex-treeview'), function(key, value){
        initSmartIndexTree(value);
    });
}

jQuery(function(){
    initSmartIndex();
    
    
    /*jQuery('.smartindex-treeview li.namespace.closed > div').delegate('','click',function(event){
        var link = jQuery(this).children("a");
        if (link.parent().siblings("ul").length == 0) {
            if (link.parent().parent().hasClass("waiting")) {
                return false;
            }
            
            link.parent().parent().addClass("waiting");
            jQuery.get('lib/plugins/smartindex/exe/ajax.php', {namespace: getParameterByName(link.attr('href'), 'idx')}, function(data){
                link.parent().parent().append(data);
                link.parent().parent().removeClass("waiting");
            });
        }
        link.parent().parent().removeClass('closed').addClass('open');
        return false;
    });
    
    jQuery('.smartindex-treeview li.namespace.open > div').live('click', function(event){
        jQuery(this).parent().removeClass('open').addClass('closed');
        return false;
    });
    
    jQuery('.smartindex-treeview li.namespace.open > div').live('click', function(event){
        jQuery(this).parent().removeClass('open').addClass('closed');
        return false;
    });
    
    jQuery('.smartindex-treeview li.page > div').live('click', function(event){
        window.location = jQuery(this).children('a').attr('href');
        return false;
    });
    
    jQuery.fn.getSmartIndexConf = function() {
        return window[jQuery(this).closest('div.smartindex-treeview').attr('id')+'_conf'];
    };*/
    
    //alert(window['test55'].baseDir);

    
    /*jQuery('.smartindex-treeview li.page > a').bind('contextmenu', function(){
        alert('context');
        return false;
    });
    
    jQuery('.smartindex-treeview li.namespace > a').live('contextmenu', function(){
        jQuery(this).parent('li').find('li.open').removeClass('open').addClass('closed');
        jQuery(this).parent('li').removeClass('open').addClass('closed');
        return false;
    });
    
    jQuery('.smartindex-treeview').bind('contextmenu', function(){
        alert('context 3');
        return false;
    });*/
    
    /*var trees = jQuery('div.smartindex-treeview');
    jQuery.each(trees, function(i, val){
        var id = jQuery(this).attr('id')+'_conf';
        jQuery.data(jQuery(this), 'conf', window[id]);
    });*/
});
